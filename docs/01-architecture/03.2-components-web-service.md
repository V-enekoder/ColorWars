@startuml
!theme plain
skinparam componentStyle uml2

title Component Diagram - Web Service (Islands Architecture)

' ==========================================
' ZONE 1: SERVER SIDE (Deno Runtime)
' This runs on your container/server
' ==========================================
package "Server Side (Deno Runtime)" {
    
    component [Route Handlers] as Routes
    note right of Routes
        <b>Controller</b>
        - Receives HTTP requests
        - Renders initial HTML (SSR)
        - Validates Rules via Engine
    end note

    component [AI Client] as AIProxy
    note left of AIProxy
        <b>Proxy / Service</b>
        - Wraps fetch calls to Python
        - Handles JSON serialization
    end note
}

' ==========================================
' ZONE 2: SHARED KERNEL (Isomorphic)
' This code exists in both runtimes
' ==========================================
rectangle "Shared Core (Isomorphic TypeScript)" {
    component [TS Game Engine] as Engine
    note right of Engine
        <b>Pure Logic (Utils)</b>
        - Rules & Move Validation
        - State Transitions
        - Used by Server AND Client
    end note
}

' ==========================================
' ZONE 3: CLIENT SIDE (Browser)
' This runs in the user's browser
' ==========================================
package "Client Side (Browser Runtime)" {
    
    component [Game Board Island] as Island
    note right of Island
        <b>Interactive UI</b>
        - Hydrated Preact Component
        - Handles Clicks/Signals
        - Optimistic Updates
    end note
}

' ==========================================
' RELATIONSHIPS & FLOW
' ==========================================

' 1. Server sends the Island to the Browser (Hydration)
Routes ..> Island : " 1. Renders / Hydrates"

' 2. Both use the Shared Engine
Routes --> Engine : " 2. Validates (Server-side)"
Island --> Engine : " 3. Simulates (Client-side)"

' 3. Server talks to External AI
Routes --> AIProxy : " 4. Delegates Prediction"

' 4. Logical flow (User interaction)
Island -up-> Routes : " 5. API Fetch (via internal API)"

@enduml
