@startuml
!theme plain
skinparam classAttributeIconSize 0

' 1. DEFINICIÓN DE TIPOS (Data Classes)
class "Board" as Board <<Value Object>> {
    + cells: int[][]
    + turn: int
}
class "Move" as Move <<Value Object>> {
    + row: int
    + col: int
}

' 2. LAS INTERFACES (Los contratos)
interface IAgent {
    ' El agente necesita el engine para simular si es Minimax
    + select_move(engine: IGameEngine, board: Board): Move
    + load_model(path: String): void
}

interface IGameEngine {
    + get_legal_moves(board: Board, player: int): List<Move>
    + apply_move(board: Board, move: Move): Board
    + is_game_over(board: Board): bool
    + get_winner(board: Board): int
}

interface IRepository {
    + save_match(match_data: Json): UUID
    + get_replay(match_id: UUID): List<Move>
}

' 3. LAS IMPLEMENTACIONES (El código real)

' Familia de Agentes
class MinimaxStrategy {
    - depth: int
    - transposition_table: Map<Hash, float>
    + select_move(engine: IGameEngine, board: Board): Move
    - alpha_beta(node, depth, alpha, beta): float
}

class PPOStrategy {
    - model: OnnxSession
    + select_move(engine: IGameEngine, board: Board): Move
    - board_to_tensor(board: Board): Tensor
}

' Familia de Motores
class PythonNaiveEngine {
    + apply_move(...): Board
    - recursive_explode(...)
}

class RustEngineWrapper {
    - rust_lib: PyObject
    + apply_move(...): Board
    ' Este usa la librería compilada
}

' 4. RELACIONES (Lo que une todo)

' Herencia / Realización (Línea sólida con triángulo vacío)
IAgent <|.. MinimaxStrategy
IAgent <|.. PPOStrategy

IGameEngine <|.. PythonNaiveEngine
IGameEngine <|.. RustEngineWrapper

' Dependencia (Línea punteada con flecha)
' CRUCIAL: Minimax necesita un Engine para funcionar
MinimaxStrategy ..> IGameEngine : "Simulates with"

' Uso de tipos
IAgent ..> Board
IAgent ..> Move

@enduml
